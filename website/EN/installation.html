<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Freedombone</title>
<!-- 2018-08-30 Thu 12:01 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Bob Mottram" />
<meta  name="description" content="Freedombone installation"
 />
<meta  name="keywords" content="freedombone, installation" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="freedombone.css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="preamble" class="status">
<a name="top" id="top"></a>
</div>
<div id="content">
<h1 class="title">Freedombone</h1>

<div class="figure">
<p><img src="images/logo.png" alt="logo.png" width="80%" height="10%" align="center" />
</p>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">Installation</h2>
<div class="outline-text-2" id="text-1">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left"><a href="#sec-2">Building an image for a Single Board Computer or Virtual Machine</a></td>
</tr>

<tr>
<td class="left"><a href="#sec-3">Checklist</a></td>
</tr>

<tr>
<td class="left"><a href="./mesh.html">Mesh network</a></td>
</tr>

<tr>
<td class="left"><a href="#sec-1">Installation</a></td>
</tr>

<tr>
<td class="left"><a href="#sec-5">Final Setup</a></td>
</tr>

<tr>
<td class="left"><i>Keydrives</i></td>
</tr>

<tr>
<td class="left"><a href="#sec-6">On Client Machines</a></td>
</tr>

<tr>
<td class="left"><a href="#sec-7">Administering the system</a></td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">Building an image for a Single Board Computer or Virtual Machine</h2>
<div class="outline-text-2" id="text-2">
<p>
You don't have to trust images downloaded from random internet locations signed with untrusted keys. You can build one from scratch yourself, and this is the recommended procedure for maximum security. For guidance on how to build images see the manpage for the <b>freedombone-image</b> command.
</p>

<p>
Install the freedombone commands onto your laptop/desktop:
</p>

<div class="org-src-container">

<pre class="src src-bash">sudo apt-get install git build-essential dialog
git clone https://code.freedombone.net/bashrc/freedombone
cd freedombone
git checkout stretch
sudo make install
</pre>
</div>

<p>
Then install packages needed for building images:
</p>

<div class="org-src-container">

<pre class="src src-bash">freedombone-image --setup debian
</pre>
</div>

<p>
or on an Arch/Parabola system:
</p>

<div class="org-src-container">

<pre class="src src-bash">freedombone-image --setup parabola
</pre>
</div>

<p>
A typical use case to build an 8GB image for a Beaglebone Black is as follows. You can change the size depending upon the capacity of your microSD card.
</p>

<div class="org-src-container">

<pre class="src src-bash">freedombone-image -t beagleboneblack -s 8G
</pre>
</div>

<p>
If you prefer an advanced installation with all of the options available then use:
</p>

<div class="org-src-container">

<pre class="src src-bash">freedombone-image -t beagleboneblack -s 8G --minimal no
</pre>
</div>

<p>
To build a 64bit Qemu image:
</p>

<div class="org-src-container">

<pre class="src src-bash">freedombone-image -t qemu-x86_64 -s 8G
</pre>
</div>

<p>
Other supported boards are cubieboard2, cubietruck, olinuxino-lime, olinuxino-lime2 and olinuxino-micro.
</p>

<p>
If the image build fails with an error such as "<i>Error reading from server. Remote end closed connection</i>" then you can specify a debian package mirror repository manually with:
</p>

<div class="org-src-container">

<pre class="src src-bash">freedombone-image -t beagleboneblack -s 8G -m http://ftp.de.debian.org/debian
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">Checklist</h2>
<div class="outline-text-2" id="text-3">
<p>
Before installing Freedombone you will need a few things.
</p>

<ul class="org-ul">
<li>Have some domains, or subdomains, registered with a dynamic DNS service. For the full install you may need two "official" purchased domains or be using a subdomain provider which is supported by Let's Encrypt.
</li>
<li>System with a new installation of Debian Stretch or a downloaded/prepared disk image
</li>
<li>Ethernet connection between the system and your internet router
</li>
<li>That it is possible to forward ports from the internet router to the system, typically via firewall settings
</li>
<li>Have ssh access to the system, typically via fbone@freedombone.local on port 2222
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4">Installation</h2>
<div class="outline-text-2" id="text-4">
<p>
There are three install options: Laptop/Desktop/Netbook, SBC and Virtual Machine.
</p>
</div>

<div id="outline-container-sec-4-1" class="outline-3">
<h3 id="sec-4-1">On a Laptop, Netbook or Desktop machine</h3>
<div class="outline-text-3" id="text-4-1">
<p>
If you have an existing system, such as an old laptop or netbook which you can leave running as a server, then install a new version of Debian Stretch onto it. During the Debian install you won't need the print server or the desktop environment, and unchecking those will reduce the attack surface. Once Debian enter the following commands:
</p>

<div class="org-src-container">

<pre class="src src-bash">su
apt-get update
apt-get -y install git dialog build-essential
git clone https://code.freedombone.net/bashrc/freedombone
cd freedombone
git checkout stretch
make install
freedombone menuconfig
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-4-2" class="outline-3">
<h3 id="sec-4-2">On a single board computer (SBC)</h3>
<div class="outline-text-3" id="text-4-2">
<p>
Currently the following boards are supported:
</p>

<ul class="org-ul">
<li><a href="https://beagleboard.org/BLACK">Beaglebone Black</a>
</li>
<li><a href="https://linux-sunxi.org/Cubietech_Cubieboard2">Cubieboard 2</a>
</li>
<li><a href="https://linux-sunxi.org/Cubietruck">Cubietruck (Cubieboard 3)</a>
</li>
<li><a href="https://www.sparkfun.com/products/retired/12856">PCDuino3</a>
</li>
<li><a href="https://www.olimex.com/Products/OLinuXino/A20/A20-OLinuXIno-LIME/open-source-hardware">olinuxino Lime</a>
</li>
<li><a href="https://www.olimex.com/Products/OLinuXino/A20/A20-OLinuXIno-LIME2/open-source-hardware">olinuxino Lime2</a>
</li>
<li><a href="https://www.olimex.com/Products/OlinuXino/A20/A20-OlinuXino-MICRO/open-source-hardware">olinuxino Micro</a>
</li>
</ul>

<p>
If there is no existing image available then you can build one from scratch. See the section above on how to do that. If an existing image is available then you can download it and check the signature with:
</p>

<div class="org-src-container">

<pre class="src src-bash">gpg --verify filename.img.asc
</pre>
</div>

<p>
And the hash with:
</p>

<div class="org-src-container">

<pre class="src src-bash">sha256sum filename.img
</pre>
</div>

<p>
If the image is compressed then decompress it with:
</p>

<div class="org-src-container">

<pre class="src src-bash">unxz filename.img.xz
</pre>
</div>

<p>
Then copy it to a microSD card. Depending on your system you may need an adaptor to be able to do that.
</p>

<div class="org-src-container">

<pre class="src src-bash">sudo dd bs=32M if=filename.img of=/dev/sdX conv=fdatasync,sync,noerror
</pre>
</div>

<p>
Where <b>sdX</b> is the microSD drive. You can check which drive is the microSD drive using:
</p>

<div class="org-src-container">

<pre class="src src-bash">ls /dev/sd*
</pre>
</div>

<p>
With the drive removed and inserted. Copying to the microSD will take a while, so go and do something less boring instead. When it's complete remove it from your system and insert it into the SBC. Connect an ethernet cable between the SBC and your internet router, then connect the power cable. On the Beaglebone Black you will see some flashing LEDs, but on other SBCs there may not be any visual indication that anything is booting.
</p>

<p>
With the board connected and running you can ssh into the system with:
</p>

<div class="org-src-container">

<pre class="src src-bash">ssh fbone@freedombone.local -p 2222
</pre>
</div>

<p>
Using the password 'freedombone'. Take a note of the new login password and then you can proceed through the rest of the installation.
</p>
</div>
</div>

<div id="outline-container-sec-4-3" class="outline-3">
<h3 id="sec-4-3">As a Virtual Machine</h3>
<div class="outline-text-3" id="text-4-3">
<p>
Qemu is currently supported, since it's s fully free software system. You can run a 64 bit Qemu image with:
</p>

<div class="org-src-container">

<pre class="src src-bash">qemu-system-x86_64 -m 1G filename.img
</pre>
</div>

<p>
The default login will be username 'fbone' and password 'freedombone'. Take a note of the new login password and then you can proceed through the rest of the installation.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5">Final Setup</h2>
<div class="outline-text-2" id="text-5">
<p>
Any manual post-installation setup instructions or passwords can be found in /home/username/README.
</p>

<p>
On your internet router, typically under firewall settings, open the following ports and forward them to your server.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">Service</th>
<th scope="col" class="right">Ports</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left">HTTP</td>
<td class="right">80</td>
</tr>

<tr>
<td class="left">HTTPS</td>
<td class="right">443</td>
</tr>

<tr>
<td class="left">SSH</td>
<td class="right">2222</td>
</tr>

<tr>
<td class="left">DLNA</td>
<td class="right">1900</td>
</tr>

<tr>
<td class="left">DLNA</td>
<td class="right">8200</td>
</tr>

<tr>
<td class="left">XMPP</td>
<td class="right">5222..5223</td>
</tr>

<tr>
<td class="left">XMPP</td>
<td class="right">5269</td>
</tr>

<tr>
<td class="left">XMPP</td>
<td class="right">5280..5281</td>
</tr>

<tr>
<td class="left">IRC</td>
<td class="right">6697</td>
</tr>

<tr>
<td class="left">Git</td>
<td class="right">9418</td>
</tr>

<tr>
<td class="left">Email</td>
<td class="right">25</td>
</tr>

<tr>
<td class="left">Email</td>
<td class="right">587</td>
</tr>

<tr>
<td class="left">Email</td>
<td class="right">465</td>
</tr>

<tr>
<td class="left">Email</td>
<td class="right">993</td>
</tr>

<tr>
<td class="left">VoIP</td>
<td class="right">64738</td>
</tr>

<tr>
<td class="left">VoIP</td>
<td class="right">5060</td>
</tr>

<tr>
<td class="left">Tox</td>
<td class="right">33445</td>
</tr>

<tr>
<td class="left">Syncthing</td>
<td class="right">22000</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6">On Client Machines</h2>
<div class="outline-text-2" id="text-6">
<p>
You can configure laptops or desktop machines which connect to the Freedombone server in the following way. This alters encryption settings to improve overall security.
</p>

<div class="org-src-container">

<pre class="src src-bash">sudo apt-get update
sudo apt-get install git dialog haveged build-essential
git clone https://code.freedombone.net/bashrc/freedombone
cd freedombone
git checkout stretch
sudo make install
freedombone-client
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7">Administering the system</h2>
<div class="outline-text-2" id="text-7">
<p>
To administer the system after installation log in via ssh, become the root user and then launch the control panel.
</p>

<div class="org-src-container">

<pre class="src src-bash">ssh myusername@freedombone.local -p 2222
</pre>
</div>

<p>
Select <i>Administrator controls</i> then from there you will be able to perform various tasks, such as backups, adding and removing users and so on. You can also do this via commands, which are typically installed as /usr/local/bin/freedombone* and the corresponding manpages.
</p>
</div>
</div>
</div>
<div id="postamble" class="status">

<style type="text/css">
.back-to-top {
    position: fixed;
    bottom: 2em;
    right: 0px;
    text-decoration: none;
    color: #000000;
    background-color: rgba(235, 235, 235, 0.80);
    font-size: 12px;
    padding: 1em;
    display: none;
}

.back-to-top:hover {
    background-color: rgba(135, 135, 135, 0.50);
}
</style>

<div class="back-to-top">
<a href="#top">Back to top</a> | <a href="mailto:bob@freedombone.net">E-mail me</a>
</div>
</div>
</body>
</html>
